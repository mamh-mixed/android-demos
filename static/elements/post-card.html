<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<polymer-element name="post-card" attributes="identity chosenTapLabel">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                width: 100%;
            }

            * {
                box-sizing: border-box;
                border: 0;
                margin: 0;
                padding: 0;
            }

            .container {
                margin-bottom: 20px;
            }

            .content {
                padding: 24px 16px 16px;
            }

            .action {
                padding: 8px 16px;
            }

            .action > .read-more-btn,
            .action > .close-more-btn {
                float: right;
            }

            .detail {
                padding: 16px 16px 24px;
            }

            .detail > .table {
                width: 100%;
            }
            .table .title{
                padding: 0 24px;
            }
            .table span {
                display: inline-block;
            }

            .table .thead {
                font-weight: bold;
                color: #6c6c6c;
            }

            .table > .thead span,
            .table > .tbody span {
                width: 20%;
            }

            .table > .thead span:first-child,
            .table > .tbody span:first-child {
                padding-left: 24px;
                width:10%;
            }

            .table > .thead span:last-child,
            .table > .tbody span:last-child {
                width: 45%;
                padding-right: 24px;
            }

            .table .thead,
            .table .row {
                border-bottom: 1px solid #e3e3e3;
                padding: 10px 0;
            }

            .table .row:last-child {
                border-bottom: none;
            }

            .table .row:hover{
                background-color: #eeeeee;
            }

            .choose-btn {
                color: #4285f4;
            }
            ::content .key-content dt {
                font-weight: bold;
            }
            ::content .key-content dd {
                word-wrap: break-word;
            }
        </style>
        <core-ajax id="routerAjax" url="/quickMaster/router/find" handleAs="json" on-core-response="{{onRouterAjaxResponse}}"></core-ajax>
        <paper-shadow z="1">
            <div class="container">
                <div class="content">
                    <content></content>
                </div>
                <div class="action">
                    <core-icon-button class="choose-btn" on-tap="{{chosenTapped}}" icon="">{{chosenTapLabel || '选择该商户'}}</core-icon-button>
                    <core-icon-button class="read-more-btn" icon="expand-more" hidden?={{isReadMore}} on-tap="{{expandMore}}"></core-icon-button>
                    <core-icon-button class="close-more-btn" icon="expand-less" hidden?={{!isReadMore}} on-tap="{{expandLess}}"></core-icon-button>
                </div>
                <div class="detail" hidden?={{!isReadMore}}>
                    <div class="table">
                        <div class="title">
                            <h2>路由表</h2>
                        </div>
                        <div class="thead">
                            <span>#</span>
                            <span>卡品牌</span>
                            <span>渠道代码</span>
                            <span>渠道商户号</span>
                        </div>
                        <div class="tbody">
                            <template repeat="{{route,index in routers}}">
                                <div class="row">
                                    <span>{{index+1}}</span>
                                    <span>{{route.cardBrand}}</span>
                                    <span>{{route.chanCode}}</span>
                                    <span>{{route.chanMerId}}</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </paper-shadow>
    </template>
    <script>
        Polymer({
            publish: {
                isReadMore: {
                    value: false,
                    reflect: true
                }
            },
            chosenTapped: function(event, detail, sender) {
                console.log("choose");
                this.fire('chosen-tap');
            },
            // 展开查看更多信息
            expandMore: function(e, d, s) {
                // 到后台加载更多信息
                var ajax = this.$.routerAjax;
                ajax.params = '{"merId":"' + this.identity + '"}';
                ajax.go();
                this.isReadMore = true;
            },
            // 收起更多信息
            expandLess: function(e, d, s) {
                this.isReadMore = false;
            },
            chooseMerchant: function(e, d, s) {

            },
            // 查找路由信息
            onRouterAjaxResponse: function() {
                var response = this.$.routerAjax.response;
                if (response.status === 0) {
                    this.routers = response.data.slice(0)
                }
            }
        });
    </script>
</polymer-element>
