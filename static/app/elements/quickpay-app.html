<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-router/app-router.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="x-pagination/x-pagination.html">
<link rel="import" href="../styles/app-theme.html">

<dom-module id="quickpay-app">
  <style>
    :host {
      display: block;
    }

    :root {
      --dark-primary-color: #05B0CF;
      --default-primary-color: #00BCD4;
      --light-primary-color: #ffffff;
      --text-primary-color: #ffffff;
      /*text/icons*/
      --accent-color: #FF4081;
      --primary-background-color: #ffffff;
      --primary-text-color: #212121;
      --secondary-text-color: #727272;
      --disabled-text-color: #bdbdbd;
      --divider-color: #B6B6B6;
      /* Components */
      /* paper-drawer-panel */
      --drawer-menu-color: #ffffff;
      --drawer-border-color: 1px solid #ccc;
      --drawer-toolbar-border-color: 1px solid rgba(0, 0, 0, 0.22);
      /* paper-menu */
      --paper-menu-background-color: #fff;
      --menu-link-color: #111111;
      --paper-input-container-input: {
        font-size: 14px;
      }
      --paper-input-container-label: {
        font-size: 14px;
      }
      --paper-menu-selected-item: {
        background-color: rgb(226, 240, 249);
      }
    }

    #drawerToolbar * {
      font-size: 20px;
      color: var(--text-primary-color);
      background-color: var(--default-primary-color);
    }

    #drawerToolbar .logo {
      margin: auto auto 10px;
    }

    paper-scroll-header-panel {
      height: 100%;
    }

    paper-material {
      border-radius: 2px;
      height: 100%;
      padding: 16px 0 16px 0;
      width: calc(98.66% - 16px);
      margin: 16px auto;
      background: white;
    }

    paper-menu iron-icon {
      margin-right: 33px;
      opacity: 0.54;
    }

    .paper-menu > .iron-selected {
      color: var(--default-primary-color);
    }

    paper-menu a {
      text-decoration: none;
      color: var(--menu-link-color);
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -ms-flex-direction: row;
      -webkit-flex-direction: row;
      flex-direction: row;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
      font-family: 'Roboto', 'Noto', sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      font-size: 14px;
      font-weight: 400;
      line-height: 24px;
      min-height: 39px;
      padding: 0 16px;
    }

    iron-collapse > paper-menu a > iron-icon {
      margin-left: 15px;
    }

    paper-toolbar.tall .app-name {
      font-size: 40px;
      font-weight: 300;
      -webkit-transform-origin: left center;
      transform-origin: left center;
    }

    #mainToolbar .middle-container {
      height: 100%;
      margin-left: 48px;
    }

    #mainToolbar:not(.tall) .middle {
      font-size: 18px;
      padding-bottom: 0;
    }

    #mainToolbar .bottom {
      margin-left: 48px;
      -webkit-transform-origin: left center;
      transform-origin: left center;
    }

    @media (max-width: 600px) {
      paper-material {
        --menu-container-display: none;
        width: calc(97.33% - 32px);
        padding-left: 16px;
        padding-right: 16px;
      }
      .paper-font-display1 {
        font-size: 12px;
      }
      paper-toolbar.tall .app-name {
        font-size: 24px;
        font-weight: 400;
      }
      #drawer .paper-toolbar {
        margin-left: 16px;
      }
      #overlay {
        min-width: 360px;
      }
      .bg {
        background: white;
      }
    }

    @media (min-width: 601px) {
      paper-material {
        width: calc(98% - 46px);
        margin-bottom: 32px;
        padding-left: 30px;
        padding-right: 30px;
      }
      iron-pages {
        padding: 15px 20px;
      }
    }
  </style>
  <template>
    <paper-drawer-panel id="paperDrawerPanel" on-paper-header-transform="paperHeaderTransform">
      <!-- Drawer Scroll Header Panel -->
      <paper-scroll-header-panel drawer fixed>

        <!-- Drawer Toolbar -->
        <paper-toolbar id="drawerToolbar">
          <img src="../images/logo2.svg" alt="云收银" class="logo">
          <div class="app-name">快捷支付管理平台</div>
        </paper-toolbar>

        <!-- 菜单列表 -->
        <paper-menu class="list" attr-for-selected="data-route" selected="{{route.name}}">
          <a data-route="config">
            <iron-icon icon="build"></iron-icon>
            <span>扫码支付商户配置</span>
          </a>
          <iron-collapse opened="{{ startWith(route.name, 'config') }}">
            <paper-menu class="list" attr-for-selected="data-route" selected="{{route.name}}">
              <a data-route="config.agents" href="#/config/agents">
                <iron-icon icon="assignment-ind"></iron-icon>
                <span>代理</span>
              </a>
              <a data-route="config.subAgents" href="#/config/subAgents">
                <iron-icon icon="account-circle"></iron-icon>
                <span>公司</span>
              </a>
              <a data-route="config.groups" href="#/config/groups">
                <iron-icon icon="home"></iron-icon>
                <span>商户</span>
              </a>
              <a data-route="config.configMer" href="#/config/configMer">
                <iron-icon icon="create"></iron-icon>
                <span>商户录入</span>
              </a>
              <a data-route="config.upload" href="#/config/upload">
                <iron-icon icon="cloud-upload"></iron-icon>
                <span>批量导入</span>
              </a>
              <a data-route="config.merchants" href="#/config/merchants">
                <iron-icon icon="store"></iron-icon>
                <span>机构商户</span>
              </a>
              <a data-route="config.chanMers" href="#/config/chanMers">
                <iron-icon icon="account-balance"></iron-icon>
                <span>渠道商户</span>
              </a>
              <a data-route="config.routes" href="#/config/routes">
                <iron-icon icon="settings-input-component"></iron-icon>
                <span>路由策略</span>
              </a>
            </paper-menu>
          </iron-collapse>
          <a data-route="quickPay">
            <iron-icon icon="home"></iron-icon>
            <span>快捷支付商户配置</span>
          </a>
          <iron-collapse opened="{{ startWith(route.name, 'quickPay') }}">
            <paper-menu class="list" attr-for-selected="data-route" selected="{{route.name}}">
              <a data-route="quickPay.merchants" href="#/quickPay/merchants">
                <iron-icon icon="store"></iron-icon>
                <span>机构商户</span>
              </a>
              <a data-route="quickPay.chanMers" href="#/quickPay/chanMers">
                <iron-icon icon="account-balance"></iron-icon>
                <span>渠道商户</span>
              </a>
              <a data-route="quickPay.routes" href="#/quickPay/routes">
                <iron-icon icon="settings-input-component"></iron-icon>
                <span>路由策略</span>
              </a>
            </paper-menu>
          </iron-collapse>

          <a data-route="trade">
            <iron-icon icon="swap-horiz"></iron-icon>
            <span>交易查询</span>
          </a>
          <iron-collapse opened="{{ startWith(route.name, 'trade') }}">
            <paper-menu class="list" attr-for-selected="data-route" selected="{{route.name}}">
              <a data-route="trade.list" href="#/trade/list">
                <iron-icon icon="payment"></iron-icon>
                <span>扫码交易</span>
              </a>
              <a data-route="trade.bindingpay.list" href="#/trade/bindingpay/list">
                <iron-icon icon="payment"></iron-icon>
                <span>绑定交易</span>
              </a>
              <a data-route="trade.reports" href="#/trade/reports">
                <iron-icon icon="file-download"></iron-icon>
                <span>报表下载</span>
              </a>
              <a data-route="trade.old.reports" href="#/trade/old/reports">
                <iron-icon icon="cloud-download"></iron-icon>
                <span>旧系统交易统计</span>
              </a>
            </paper-menu>
          </iron-collapse>

          <a data-route="test">
            <iron-icon icon="bug-report"></iron-icon>
            <span>内部测试</span>
          </a>
          <iron-collapse opened="{{ startWith(route.name, 'test') }}">
            <paper-menu class="list" attr-for-selected="data-route" selected="{{route.name}}">
              <a data-route="test.scanpay" href="#/test/scanpay">
                <iron-icon icon="pageview"></iron-icon>
                <span>扫码支付</span>
              </a>
              <a data-route="test.bindingpay" href="#/test/bindingpay">
                <iron-icon icon="icons:speaker-notes"></iron-icon>
                <span>绑定支付</span>
              </a>
              <a data-route="test.qiniu" href="#/test/qiniu">
                <iron-icon icon="cloud-upload"></iron-icon>
                <span>七牛 Ajax 上传文件</span>
              </a>
              <a data-route="test.filereader" href="#/test/filereader">
                <iron-icon icon="get-app"></iron-icon>
                <span>HTML5 读取文件内容</span>
              </a>
            </paper-menu>
          </iron-collapse>

        </paper-menu>
      </paper-scroll-header-panel>

      <!-- Main Area -->
      <paper-scroll-header-panel main condenses keep-condensed-header>

        <!-- Main Toolbar -->
        <paper-toolbar id="mainToolbar" class="tall">
          <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>
          <span class="flex"></span>

          <!-- Toolbar icons -->
          <paper-icon-button icon="refresh"></paper-icon-button>
          <paper-icon-button icon="search"></paper-icon-button>

          <!-- Application name -->
          <div class="middle middle-container center horizontal layout" id="middleContainer">
            <div class="app-name" id="appName">{{route.title}}</div>
          </div>

          <!-- Application sub title -->
          <div class="bottom bottom-container center horizontal layout" id="bottomContainer">
            <div class="bottom-title paper-font-subhead">{{route.subtitle}}</div>
          </div>

        </paper-toolbar>

        <!-- Main Content -->
        <div class="content">
          <app-router id="appRouter" key="main" main on-state-change="stateChange">
            <app-route path="/" name="homePage" import="elements/test-scanpay/test-scanpay.html"></app-route>

            <app-route path="/config/agents" name="agentList" import="elements/agent-list/agent-list.html"></app-route>
            <app-route path="/config/subAgents" name="subAgentList" import="elements/sub-agent-list/sub-agent-list.html"></app-route>
            <app-route path="/config/chanMers" name="channel-merchant-list" import="elements/channel-merchant-list/channel-merchant-list.html"></app-route>
            <app-route path="/config/configMer" name="config-merchant" import="elements/config-merchant/config-merchant.html"></app-route>
            <app-route path="/config/groups" name="group-list" import="elements/group-list/group-list.html"></app-route>
            <app-route path="/config/upload" name="group-list" import="elements/file-upload/file-upload.html"></app-route>
            <app-route path="/config/merchants" name="merchant-list" import="elements/merchant-list/merchant-list.html"></app-route>
            <app-route path="/config/routes" name="route-list" import="elements/route-list/route-list.html"></app-route>

            <app-route path="/quickPay/chanMers" name="quick-chanMer-list" import="elements/quick-chanMer-list/quick-chanMer-list.html"></app-route>
            <app-route path="/quickPay/merchants" name="quick-merchant-list" import="elements/quick-merchant-list/quick-merchant-list.html"></app-route>
            <app-route path="/quickPay/routes" name="quick-route-list" import="elements/quick-route-list/quick-route-list.html"></app-route>

            <app-route path="/trade/list" name="trade-list" import="elements/trade-list/trade-list.html"></app-route>
            <app-route path="/trade/reports" name="report-list" import="elements/report-list/report-list.html"></app-route>
            <app-route path="/trade/bindingpay/list" name="trade-bindingpay-list" import="elements/bindingpay-trade-list/bindingpay-trade-list.html"></app-route>
            <app-route path="/trade/old/reports" name="report-list-old" import="elements/report-list-old/report-list-old.html"></app-route>

            <app-route path="/test/bindingpay" name="test-bindingpay" import="elements/test-bindingpay/test-bindingpay.html"></app-route>
            <app-route path="/test/filereader" name="test-filereader" import="elements/test-filereader/test-filereader.html"></app-route>
            <app-route path="/test/qiniu" name="test-qiniu" import="elements/test-qiniu/test-qiniu.html"></app-route>
            <app-route path="/test/scanpay" name="test-scanpay" import="elements/test-scanpay/test-scanpay.html"></app-route>
          </app-router>
        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>

    <paper-toast id="toast" duration="5000" visible="true" text="Caching complete! This app will work offline."></paper-toast>

  </template>
  <script>
    (function() {
      Polymer({
        is: 'quickpay-app',

        properties: {
          foo: {
            type: String,
            value: 'bar',
            notify: true
          },
          routes: {
            type: Object,
            value: {}
          },
        },
        ready: function() {
          var routeMap = {
            '/': {
              name: 'config.configMer',
              path: '/config/configMer',
              title: '配置扫码支付商户和渠道',
              subtitle: '录入机构商户，配置渠道商户（微信、支付宝、QQ 钱包）'
            },
            '/config/configMer': {
              name: 'config.configMer',
              path: '/config/configMer',
              title: '配置扫码支付商户和渠道',
              subtitle: '录入机构商户，配置渠道商户（微信、支付宝、QQ 钱包）'
            },
            '/config/merchant/:merId': {
              name: 'config.merchant',
              path: '/config/merchant/:merId',
              title: '变更扫码支付商户和渠道',
              subtitle: '变更机构商户，配置渠道商户（微信、支付宝、QQ 钱包）',
            },
            '/config/merchants': {
              name: 'config.merchants',
              path: '/config/merchants',
              title: '机构商户',
              subtitle: '机构商户'
            },
            '/config/chanMers': {
              name: 'config.chanMers',
              path: '/config/chanMers',
              title: '渠道商户',
              subtitle: '渠道商户'
            },
            '/config/routes2/:merId': {
              name: 'config.routes2',
              path: '/config/routes2/:merId',
              title: '路由策略',
              subtitle: '路由策略',
            },
            '/config/routes': {
              name: 'config.routes',
              path: '/config/routes',
              title: '路由策略',
              subtitle: '路由策略',
            },
            '/config/agents': {
              name: 'config.agents',
              path: '/config/agents',
              title: '代理/机构',
              subtitle: '代理/机构'
            },
            '/config/subAgents': {
              name: 'config.subAgents',
              path: '/config/subAgents',
              title: '公司',
              subtitle: '公司'
            },
            '/config/groups': {
              name: 'config.groups',
              path: '/config/groups',
              title: '商户',
              subtitle: '商户'
            },
            '/trade/list': {
              name: 'trade.list',
              path: '/trade/list',
              title: '扫码支付交易查询',
              subtitle: '查询下单、预下单、支付、查询、退款、关闭订单、企业支付、公众号支付的交易'
            },
            '/trade/reports': {
              name: 'trade.reports',
              path: '/trade/reports',
              title: '交易报表下载',
              subtitle: '交易报表下载'
            },
            '/trade/old/reports': {
              name: 'trade.old.reports',
              path: '/trade/old/reports',
              title: '旧系统交易统计',
              subtitle: '旧系统交易统计'
            },
            '/test/scanpay': {
              name: 'test.scanpay',
              path: '/test/scanpay',
              title: '扫码支付交易测试',
              subtitle: '测试下单、预下单、支付、查询、退款、关闭订单、企业支付'
            },
            '/test/bindingpay': {
              name: 'test.bindingpay',
              path: '/test/bindingpay',
              title: '绑定支付交易测试',
              subtitle: '绑定支付交易测试'
            },
            '/test/qiniu': {
              name: 'test.qiniu',
              path: '/test/qiniu',
              title: '测试七牛上传文件',
              subtitle: '测试七牛 Ajax 上传文件'
            },
            '/test/filereader': {
              name: 'test.filereader',
              path: '/test/filereader',
              title: '测试 HTML5 读取文件内容',
              subtitle: '测试 HTML5 读取文件内容'
            },
            '/quickPay/merchants': {
              name: 'quickPay.merchants',
              path: '/quickPay/merchants',
              title: '快捷支付机构商户',
              subtitle: '快捷支付机构商户'
            },
            '/quickPay/chanMers': {
              name: 'quickPay.chanMers',
              path: '/quickPay/chanMers',
              title: '快捷支付渠道商户',
              subtitle: '快捷支付渠道商户'
            },
            '/quickPay/routes': {
              name: 'quickPay.routes',
              path: '/quickPay/routes',
              title: '快捷支付路由策略',
              subtitle: '快捷支付路由策略',
            },
            '/config/upload': {
              name: 'config.upload',
              path: '/config/upload',
              title: '批量导入',
              subtitle: '批量导入'
            },
            '/trade/bindingpay/list': {
              name: 'trade.bindingpay.list',
              path: '/trade/bindingpay/list',
              title: '绑定支付交易查询',
              subtitle: ''
            },
          };
          this.set('routes', routeMap);
          this.set('isReady', true);
          this.set('route', this.routes[window.location.hash.substr(1)]);
        },
        attached: function() {
          console.log(this);
        },
        stateChange: function(e) {
          if (!this.isReady) {
            return;
          }
          console.log(e.type, e.detail.path); // parsed URL path
          // e.preventDefault(); // cancel the new route
          this.set('route', this.routes[e.detail.path]);
        },
        paperHeaderTransform: function(e) {
          var appName = this.$.appName;
          var middleContainer = this.$.middleContainer;
          var bottomContainer = this.$.bottomContainer;
          var detail = e.detail;
          var heightDiff = detail.height - detail.condensedHeight;
          var yRatio = Math.min(1, detail.y / heightDiff);
          var maxMiddleScale = 0.50; // appName max size when condensed. The smaller the number the smaller the condensed size.
          var scaleMiddle = Math.max(maxMiddleScale, (heightDiff - detail.y) / (heightDiff / (1 - maxMiddleScale)) + maxMiddleScale);
          var scaleBottom = 1 - yRatio;

          // Move/translate middleContainer
          Polymer.Base.transform('translate3d(0,' + yRatio * 100 + '%,0)', middleContainer);

          // Scale bottomContainer and bottom sub title to nothing and back
          Polymer.Base.transform('scale(' + scaleBottom + ') translateZ(0)', bottomContainer);

          // Scale middleContainer appName
          Polymer.Base.transform('scale(' + scaleMiddle + ') translateZ(0)', appName);
        },
        startWith: function(name, prefix) {
          if (!name || !prefix) {
            return true;
          }
          return name.substring(0, prefix.length) === prefix;
        }
      });
    })();
  </script>
</dom-module>
