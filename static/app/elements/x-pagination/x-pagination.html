<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="x-pagination">
  <style>
    :host {
      display: block;
    }

    .pagination {
      display: inline-block;
      padding-left: 0;
      margin: 20px 0;
      border-radius: 4px;
    }

    .pagination>li {
      display: inline;
    }

    .pagination>li>a {
      position: relative;
      float: left;
      padding: 6px 12px;
      margin-left: -1px;
      line-height: 1.42857143;
      /*color: #337ab7;*/
      color: #777;
      text-decoration: none;
      background-color: #fff;
      /*border: 1px solid #ddd;*/
      cursor: pointer;
    }

    .pagination>.active>a,
    .pagination>.active>a:focus,
    .pagination>.active>a:hover {
      z-index: 2;
      /*color: #fff;*/
      color: #3498db;
      cursor: default;
      /*background-color: #337ab7;
      border-color: #337ab7;*/
    }

    .pagination>.disabled>a,
    .pagination>.disabled>a:focus,
    .pagination>.disabled>a:hover {
      color: #777;
      cursor: not-allowed;
      background-color: #fff;
      border-color: #ddd;
      cursor: default;
    }

    .pagination>li:first-child>a {
      margin-left: 0;
      /*border-top-left-radius: 4px;*/
      /*border-bottom-left-radius: 4px;*/
    }

    .pagination>li:last-child>a {
      /*border-top-right-radius: 4px;*/
      /*border-bottom-right-radius: 4px;*/
    }
  </style>
  <template>
    <ul class="pagination">
      <li id="firstPage">
        <a on-tap="toFirstPage">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li id="prevPage">
        <a on-tap="toPrevPage">
          <span aria-hidden="true">&lt;</span>
        </a>
      </li>

      <template is="dom-if" if="{{isPreEllipsis}}">
        <li><a>...</a></li>
      </template>

      <template is="dom-repeat" items="{{pageArray}}">
        <template is="dom-if" if="{{item.isActive}}">
          <li class="active"><a>{{item.value}}</a></li>
        </template>
        <template is="dom-if" if="{{!item.isActive}}">
          <li><a on-tap="goToPage">{{item.value}}</a></li>
        </template>
      </template>

      <template is="dom-if" if="{{isAfterEllipsis}}">
        <li><a>...</a></li>
      </template>

      <li id="nextPage">
        <a on-tap="toNextPage">
          <span aria-hidden="true">&gt;</span>
        </a>
      </li>
      <li id="lastPage">
        <a on-tap="toLastPage">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </template>
  <script>
    (function() {
      Polymer({
        is: 'x-pagination',

        properties: {
          total: {
            type: Number,
            value: 0
          },
          size: {
            type: Number,
            value: 20
          },
          page: {
            type: Number,
            value: 1,
            notify: true
          },
          pageArray: {
            type: Array,
            value: []
          }
        },
        observers: [
          '_paginationChanged(total, page)'
        ],
        _paginationChanged: function() {
          if (this.total === 0) {
            this.toggleAttribute('hidden', true);
            return;
          }
          this.toggleAttribute('hidden', false);
          this.set('size', this.size || 20);
          this.set('page', this.page || 0);

          var maxPage = Math.ceil(this.total / this.size);
          console.log('max page is ', maxPage);
          this.set('pageArray', []);

          var i = this.page - 2;
          if (maxPage - this.page < 5) {
            i = maxPage - 4;
          }
          for (var l = 1; l <= Math.min(5, maxPage); i++) {
            if (i > 0) {
              this.push('pageArray', {
                value: i,
                isActive: i === this.page ? true : false
              });
              l++;
            }
          }

          if (this.page > 3) {
            this.isPreEllipsis = true;
          } else {
            this.isPreEllipsis = false;
          }

          if (maxPage - this.page > 2) {
            this.isAfterEllipsis = true;
          } else {
            this.isAfterEllipsis = false;
          }

          if (this.page === 1) {
            this.toggleClass('disabled', true, this.$.firstPage);
            this.toggleClass('disabled', true, this.$.prevPage);
          } else {
            this.toggleClass('disabled', false, this.$.firstPage);
            this.toggleClass('disabled', false, this.$.prevPage);
          }

          if (this.page === maxPage) {
            this.toggleClass('disabled', true, this.$.nextPage);
            this.toggleClass('disabled', true, this.$.lastPage);
          } else {
            this.toggleClass('disabled', false, this.$.nextPage);
            this.toggleClass('disabled', false, this.$.lastPage);
          }
        },
        // 每一页跳转啊
        goToPage: function(e) {
          var page = e.model.item.value;
          this.set('page', page);
          this.fire('page-change', page);
        },
        // 到首页
        toFirstPage: function() {
          if (this.page <= 1) {
            return;
          }

          this.set('page', 1);
          this.fire('page-change', page);
        },
        // 到前一页
        toPrevPage: function() {
          if (this.page <= 1) {
            return;
          }

          this.set('page', --this.page);
          this.fire('page-change', page);
        },
        // 到下一页
        toNextPage: function() {
          var maxPage = Math.ceil(this.total / this.size);
          if (this.page >= maxPage) {
            return;
          }

          this.set('page', ++this.page);
          this.fire('page-change', page);
        },
        // 到最后一页
        toLastPage: function() {
          var maxPage = Math.ceil(this.total / this.size);
          if (this.page >= maxPage) {
            return;
          }

          this.set('page', Math.ceil(this.total / this.size));
          this.fire('page-change', page);
        }
      });
    })();
  </script>
</dom-module>
