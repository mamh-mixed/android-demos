<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../x-select/x-select.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">

<dom-module id="x-pagination">
  <style>
    :host {
      display: inline-block;
      line-height: 24px;
      white-space: nowrap;
    }

    :host > div {
      display: inline-block;
      margin: auto 12px;
    }

    div.size > select {
      border: none;
      background: none;
      outline: none;
      cursor: pointer;
    }

    div.pre-next * {
      margin: auto 4px;
      cursor: pointer;
    }
  </style>
  <template>

    <div class="size">
      <span>每页显示</span>
      <select id="size" name="size" value="{{size}}" on-change="changeSize">
        <option>10</option>
        <option selected>20</option>
        <option>50</option>
        <option>100</option>
      </select>
      <span>条</span>
    </div>

    <div class="offset">
      <span>{{from}}</span>
      <span>&nbsp;-&nbsp;</span>
      <span>{{to}}</span>
      <span>&nbsp;/&nbsp;</span>
      <span>{{total}}</span>
    </div>

    <div class="pre-next">
      <iron-icon icon="av:skip-previous" on-tap="firstPage"></iron-icon>
      <iron-icon icon="chevron-left" on-tap="prePage"></iron-icon>
      <iron-icon icon="chevron-right" on-tap="nextPage"></iron-icon>
      <iron-icon icon="av:skip-next" on-tap="lastPage"></iron-icon>
    </div>

    <!-- <input name="size" type="hidden" value="{{size}}" /> -->
    <input name="page" type="hidden" value="{{page}}" />
    <input type="submit" style="display: none" />
  </template>
  <script>
    Polymer({
      is: 'x-pagination',

      properties: {
        total: {
          type: Number,
          value: 0,
          notify: true
        },
        size: {
          type: Number,
          value: 20,
          notify: true
        },
        page: {
          type: Number,
          value: 1,
          notify: true
        }
      },
      ready: function() {
        this._pageChange();
      },
      observers: [
        '_pageChange(total, page, size)',
        '_pageNumChange(total,size)'
      ],
      _pageChange: function() {
        if (!this.total || this.total === 0) {
          this.total = 0;
          this.from = 0;
          this.to = 0;
        } else {
          this.from = (this.page - 1) * this.size + 1;
          this.to = this.from + this.size - 1;
          if (this.to > this.total) {
            this.to = this.total;
          }
        }
      },
      _pageNumChange: function() {
        if (!this.total || this.total === 0) {
          this.pageNum = 0;
        } else {
          this.pageNum = Math.ceil(this.total / this.size);
        }
      },
      changeSize: function() {
        this.set('size', +this.$.size.value);
        this.fire('page-change');
        this._pageChange();
      },
      prePage: function() {
        if (this.page <= 1) {
          return;
        }
        this.set('page', this.page - 1);
        this.fire('page-change');
      },
      nextPage: function() {
        if (this.to >= this.total) {
          return;
        }
        this.set('page', this.page + 1);
        this.fire('page-change');
      },
      firstPage: function() {
        if (this.page <= 1) {
          return;
        }
        this.set('page', 1);
        this.fire('page-change');
      },
      lastPage: function() {
        if (this.page >= this.pageNum) {
          return;
        }
        this.set('page', this.pageNum);
        this.fire('page-change');
      }

    });
  </script>
</dom-module>
