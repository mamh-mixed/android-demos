<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">

<dom-module id="user-view">

  <style>
    :host {
      display: block;
      --paper-dialog-scrollable: {
        width: 450px;
        min-height: 400px;
        max-height: 400px;
        font-size: 14px;
      }
    }
  </style>
  <template>
    <paper-dialog id="dialogView">
      <h2>查看用户信息</h2>
      <paper-dialog-scrollable>
        <table class="data-grid low">
          <tr>
            <td>用户名:</td>
            <td>{{item.userName}}</td>
          </tr>
          <tr>
            <td>显示名:</td>
            <td>{{item.nickName}}</td>
          </tr>
          <tr>
            <td>邮箱:</td>
            <td>{{item.mail}}</td>
          </tr>
          <tr>
            <td>手机号:</td>
            <td>{{item.phoneNum}}</td>
          </tr>
          <tr>
            <td>用户类型:</td>
            <td>{{getUserType(item.userType)}}</td>
          </tr>
          <tr>
            <td>代理代码:</td>
            <td>{{item.agentCode}}</td>
          </tr>
          <tr>
            <td>公司代码:</td>
            <td>{{item.subAgentCode}}</td>
          </tr>
          <tr>
            <td>商户代码:</td>
            <td>{{item.groupCode}}</td>
          </tr>
          <tr>
            <td>门店代码:</td>
            <td>{{item.merId}}</td>
          </tr>
        </table>
      </paper-dialog-scrollable>
      <div class="buttons">
        <label hidden$="{{!deleteFlag}}" style="color:#FF0000;line-height:40px;">您确定要删除这个用户吗?</label>
        <paper-button hidden$="{{!deleteFlag}}" on-tap="cancelDeleteTap">取消</paper-button>
        <paper-button hidden$="{{!deleteFlag}}" on-tap="confirmDeleteTap">确定</paper-button>
        <paper-button hidden$="{{deleteFlag}}" on-tap="deleteTap">删除</paper-button>
        <paper-button on-tap="handleItemEditedEvent">编辑</paper-button>
        <paper-button on-tap="handleEditePwdTapped">修改密码</paper-button>
        <paper-button on-tap="handleClose">关闭</paper-button>
      </div>
    </paper-dialog>
    <iron-ajax id="deleteMerAjax" method="GET" url="/master/user/delete" handle-as="json" on-response="handleDeleteResponse"></iron-ajax>
  </template>
  <script>
    Polymer({
      is: 'user-view',
      properties: {
        item: Object,
      },
      open: function() {
        this.$.dialogView.open();
        this.deleteFlag = false;
      },
      ready: function() {
        this.userTypeMap = {
          admin: '讯联',
          agent: '代理',
          subAgent: '公司',
          group: '商户',
          merchant: '门店'
        };
      },
      // 关闭事件
      handleClose: function() {
        this.$.dialogView.close();
      },
      // 编辑事件
      handleItemEditedEvent: function() {
        this.fire('editor');
        this.handleClose();
      },
      handleEditePwdTapped: function() {
        this.fire('editor-pwd');
        this.handleClose();
      },
      // 删除事件
      deleteTap: function() {
        this.deleteFlag = true;
      },
      // 取消删除事件
      cancelDeleteTap: function() {
        this.deleteFlag = false;
      },
      // 确认删除
      confirmDeleteTap: function() {
        this.$.deleteMerAjax.params = {
          merId: this.item.merId
        };
        this.$.deleteMerAjax.generateRequest();
      },
      // 删除用户响应信息
      handleDeleteResponse: function(e) {
        var response = e.detail.response;
        if (response.status !== 0) {
          Util.toast(response.message, 3000);
          return;
        }
        Util.toast(response.message, 3000);
        this.$.dialogView.close();
        this.fire('delete-ok');
      },
      getUserType: function(key) {
        return this.userTypeMap[key];
      },
    });
  </script>
</dom-module>
