<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../x-select/x-select.html">

<dom-module id="x-pagination">
  <style>
    :host {
      display: inline-block;
      line-height: 24px;
      white-space: nowrap;
    }

    div {
      display: inline-block;
      margin: auto 12px;
    }

    iron-icon {
      height: 1.2em !important;
    }

    div.size > select {
      border: none;
      background: none;
      outline: none;
      cursor: pointer;
    }

    div.pre-next * {
      margin: auto 4px;
      cursor: pointer;
    }

    .icon-button > iron-icon[disabled] {
      opacity: 0.3;
      cursor: default;
    }

    .icon-button {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 30px;
      text-align: center;
    }
    .icon-button > iron-icon {
      transition: -webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .icon-button:hover > iron-icon:not([disabled]) {
      -webkit-transform: scale(1.4);
         -moz-transform: scale(1.4);
          -ms-transform: scale(1.4);
           -o-transform: scale(1.4);
              transform: scale(1.4);
    }
    .icon-button > paper-ripple {
      overflow: hidden;
      color: #646464;
    }
  </style>
  <template>
    <div class="size">
      <span>每页显示</span>
      <select id="size" name="size" value="{{size}}" on-change="changeSize">
        <option>10</option>
        <option selected>20</option>
        <option>50</option>
        <option>100</option>
      </select>
      <span>条</span>
    </div>

    <div class="offset">
      <span>{{from}}</span>
      <span>&nbsp;-&nbsp;</span>
      <span>{{to}}</span>
      <span>&nbsp;/&nbsp;</span>
      <span>{{total}}</span>
    </div>

    <div class="pre-next">
      <div class="icon-button">
        <iron-icon icon="av:skip-previous" on-tap="firstPage" disabled$={{isFirstPage}}></iron-icon>
        <paper-ripple class="circle" recenters noink$={{isFirstPage}}></paper-ripple>
      </div>
      <div class="icon-button">
        <iron-icon icon="chevron-left" on-tap="prePage" disabled$={{isFirstPage}}></iron-icon>
        <paper-ripple class="circle" recenters noink$={{isFirstPage}}></paper-ripple>
      </div>
      <div class="icon-button">
        <iron-icon icon="chevron-right" on-tap="nextPage" disabled$={{isLastPage}}></iron-icon>
        <paper-ripple class="circle" recenters noink$={{isLastPage}}></paper-ripple>
      </div>
      <div class="icon-button">
        <iron-icon icon="av:skip-next" on-tap="lastPage" disabled$={{isLastPage}}></iron-icon>
        <paper-ripple class="circle" recenters noink$={{isLastPage}}></paper-ripple>
      </div>
    </div>

    <!-- <input name="size" type="hidden" value="{{size}}" /> -->
    <input name="page" type="hidden" value="{{page}}" />
    <input type="submit" style="display: none" />
  </template>
  <script>
    Polymer({
      is: 'x-pagination',

      properties: {
        total: {
          type: Number,
          value: 0,
          notify: true
        },
        size: {
          type: Number,
          value: 20,
          notify: true
        },
        page: {
          type: Number,
          value: 1,
          notify: true
        },
        isFirstPage: {
          type: Boolean,
          value: false
        },
        isLastPage: {
          type: Boolean,
          value: false
        }
      },
      ready: function() {
        this._pageChange();
      },
      observers: [
        '_pageChange(total, page, size)',
        '_pageNumChange(total,size)'
      ],
      _pageChange: function() {
        if (!this.total || this.total === 0) {
          this.total = 0;
          this.from = 0;
          this.to = 0;
          this.isFirstPage = true;
          this.isLastPage = true;
        } else {
          this.from = (this.page - 1) * this.size + 1;
          this.to = this.from + this.size - 1;
          if (this.to > this.total) {
            this.to = this.total;
          }

          this.isFirstPage = this.from === 1 ? true : false;
          this.isLastPage = this.to === this.total ? true : false;
        }
      },
      _pageNumChange: function() {
        if (!this.total || this.total === 0) {
          this.pageNum = 0;
        } else {
          this.pageNum = Math.ceil(this.total / this.size);
        }
      },
      changeSize: function() {
        this.set('size', +this.$.size.value);
        this.fire('page-change');
        this._pageChange();
      },
      prePage: function() {
        if (this.page <= 1) {
          return;
        }
        this.set('page', this.page - 1);
        this.fire('page-change');
      },
      nextPage: function() {
        if (this.to >= this.total) {
          return;
        }
        this.set('page', this.page + 1);
        this.fire('page-change');
      },
      firstPage: function() {
        if (this.page <= 1) {
          return;
        }
        this.set('page', 1);
        this.fire('page-change');
      },
      lastPage: function() {
        if (this.page >= this.pageNum) {
          return;
        }
        this.set('page', this.pageNum);
        this.fire('page-change');
      }

    });
  </script>
</dom-module>
