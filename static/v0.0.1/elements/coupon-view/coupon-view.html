<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<dom-module id="coupon-view">
  <style>
    :host {
      display: block;
      --paper-dialog-scrollable: {
        width: 600px;
        height: 340px;
      }
    }

    paper-dialog-scrollable /deep/ #scrollable {
      min-height: auto;
    }
  </style>
  <template>
    <paper-dialog with-backdrop id="dialogView">
      <h2>交易明细</h2>
      <paper-dialog-scrollable>
        <!-- 订单明细 -->
        <div class="content">
          <div class="table data-grid low" id="orderDetail">
            <div class="tr">
              <div class="td key">门店代码:</div>
              <div class="td">{{item.merId}}</div>
              <div class="td key">门店名称:</div>
              <div class="td">{{item.merName}}</div>
            </div>
            <div class="tr">
              <div class="td key">商户代码:</div>
              <div class="td">{{item.groupCode}}</div>
              <div class="td key">商户名称:</div>
              <div class="td">{{item.groupName}}</div>
            </div>
            <div class="tr">
              <div class="td key">公司代码:</div>
              <div class="td">{{item.subAgentCode}}</div>
              <div class="td key">公司名称:</div>
              <div class="td">{{item.subAgentName}}</div>
            </div>
            <div class="tr">
              <div class="td key">代理代码:</div>
              <div class="td">{{item.agentCode}}</div>
              <div class="td key">代理名称:</div>
              <div class="td">{{item.agentName}}</div>
            </div>
            <div class="tr">
              <div class="td key">终端代码:</div>
              <div class="td">{{item.terminalid}}</div>
              <div class="td key">商户订单:</div>
              <div class="td">{{item.orderNum}}</div>
            </div>
            <div class="tr">
              <div class="td key">交易渠道:</div>
              <div class="td">{{chanFilter(item.chanCode)}}</div>
              <div class="td key">交易类型:</div>
              <div class="td">{{busicdFilter(item.busicd)}}</div>
            </div>
            <div class="tr">
              <div class="td key">渠道商户:</div>
              <div class="td">{{item.chanMerId}}</div>
              <div class="td key">渠道订单:</div>
              <div class="td">{{item.chanOrderNum}}</div>
            </div>
            <div class="tr">
              <div class="td key">应答码:</div>
              <div class="td">{{item.respcd}}</div>
              <div class="td key">核销状态:</div>
              <div class="td">{{writeoffStatusFilter(item.writeoffStatus)}}</div>
            </div>
            <div class="tr">
              <div class="td key">创建时间:</div>
              <div class="td">{{item.transTime}}</div>
              <div class="td key">修改时间:</div>
              <div class="td">{{item.updateTime}}</div>
            </div>
            <div class="tr">
              <div class="td key">卡券名称:</div>
              <div class="td">{{item.prodname}}</div>
              <div class="td key">卡券明细:</div>
              <div class="td">{{item.cardInfo}}</div>
            </div>
            <div class="tr">
              <div class="td key">核销次数:</div>
              <div class="td">{{item.veriTime}}</div>
              <div class="td key">可用次数:</div>
              <div class="td">{{item.availCount}}</div>
            </div>
            <div class="tr">
              <div class="td key">主机授权码:</div>
              <div class="td">{{item.authcode}}</div>
              <div class="td key">券有效期:</div>
              <div class="td">{{item.expDate}}</div>
            </div>
            <div class="tr">
              <div class="td key">关联订单:</div>
              <div class="td">{{item.origOrderNum}}</div>
              <div class="td key">实际支付金额:</div>
              <div class="td">{{moneyFilter(item.actualPayAmount)}}</div>
            </div>
            <div class="tr">
              <div class="td key">原始交易金额:</div>
              <div class="td">{{moneyFilter(item.transAmt)}}</div>
              <div class="td key">cardbin:</div>
              <div class="td">{{item.cardbin}}</div>
            </div>
            <div class="tr">
              <div class="td key">交易类型:</div>
              <div class="td">{{payTypeFilter(item.payType)}}</div>
              <div class="td key">券类型:</div>
              <div class="td">{{voucherTypeFilter(item.voucherType)}}</div>
            </div>
            <div class="tr">
              <div class="td key">最小金额:</div>
              <div class="td">{{moneyFilter(item.saleMinAmount)}}</div>
              <div class="td key">抵扣值:</div>
              <div class="td">{{moneyFilter(item.saleDiscount)}}</div>
            </div>
          </div>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button on-tap="handleClose">关闭</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
    var TRANS_TYPE_MAP = {
      'VERI': '卡券核销/查询',
      'CRVE': '刷卡核销',
      'QUVE': '验券查询',
      'CAVE': '撤销',
    };
    Polymer({
      is: 'coupon-view',

      properties: {
        item: Object,
      },
      open: function() {
        this.$.dialogView.open();
      },
      // 关闭事件
      handleClose: function() {
        this.$.dialogView.close();
      },
      writeoffStatusFilter: function(status) {
        var map = {
          'ERROR': '失败',
          'SUCCESS': '成功',
          'PROCESS': '处理中',
        };
        return (status + '—' + map[status]);
      },
      busicdFilter: function(busicd) {
        return (busicd + '—' + TRANS_TYPE_MAP[busicd]) || busicd;
      },
      chanFilter: function(chanCode) {
        var map = {
          'ALP': '支付宝',
          'WXP': '微信',
          'ULIVE': '优方'
        };
        return (chanCode + '—' + map[chanCode]);
      },
      moneyFilter: function(money) {
        if (!money || money == ""){
            return "";
        }
        var amount = (money / Math.pow(10, 2)).toFixed(2);
        return Util.beautifyAmount(amount);
      },
      voucherTypeFilter: function(voucherType) {
        if (!voucherType || voucherType == "") {
          return "";
        }
        var map = {
          '1': '普通满减券',
          '2': '提货券',
          '3': '普通满折券',
          '21': '刷银行卡满减券',
          '22': '刷银行卡固定金额券',
          '23': '刷银行卡满折券',
          '31': '礼包券',
          '41': '微信支付满减券',
          '42': '微信支付 固定金额券',
          '43': '微信支付满折券',
          '51': '支付宝支付满减券',
          '52': '支付宝支付固定金额券',
          '53': '支付宝支付满 折券',
        };
        return (voucherType + '—' + map[voucherType]);
      },
      payTypeFilter: function(payType) {
        if (!payType || payType == "") {
          return "";
        }
        var map = {
          '2': '银行卡支付',
          '4': '微信支付',
          '5': '支付宝支付',
        }
        return (payType + '—' + map[payType]);
      },
    });
  </script>
</dom-module>
